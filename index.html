<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Alloc | Enterprise Workflow System</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fix: Shim process for libraries that expect it -->
    <script>
        window.process = { env: { NODE_ENV: 'production' } };
    </script>

    <!-- Prop Types (Critical Dependency for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts (Pinned Version) -->
    <script src="https://unpkg.com/recharts@2.10.4/umd/Recharts.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background-color: #f3f4f6; font-family: 'Segoe UI', sans-serif; }
        .deloitte-green { color: #86BC25; }
        .deloitte-bg-green { background-color: #86BC25; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Fix: Check if Recharts loaded correctly
        const Recharts = window.Recharts || { BarChart: () => null, Bar: () => null, XAxis: () => null, YAxis: () => null, CartesianGrid: () => null, Tooltip: () => null, ResponsiveContainer: () => null };
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

        // --- Mock Data ---
        const initialEmployees = [
            { id: 1, name: 'Amit Sharma', role: 'Senior Analyst' },
            { id: 2, name: 'Priya Verma', role: 'Developer' },
            { id: 3, name: 'Rohan Das', role: 'Data Scientist' },
        ];

        const initialTasks = [
            { id: 101, title: 'Client Requirement Analysis', assignee: 'Amit Sharma', status: 'In Progress', priority: 'High', hours: 12, proof: '' },
            { id: 102, title: 'Database Migration', assignee: 'Priya Verma', status: 'Completed', priority: 'Medium', hours: 8, proof: 'github.com/commit/8x9d0' },
            { id: 103, title: 'Q1 Financial Modeling', assignee: 'Amit Sharma', status: 'Pending', priority: 'High', hours: 15, proof: '' },
        ];

        // --- Components ---

        const Toast = ({ message, type, onClose }) => {
            useEffect(() => { setTimeout(onClose, 3000); }, [onClose]);
            return (
                <div className={`fixed bottom-5 right-5 px-6 py-4 rounded-lg shadow-xl text-white font-bold z-50 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`}>
                    {message}
                </div>
            );
        };

        const LoginScreen = ({ employees, onLogin }) => {
            const [selectedUser, setSelectedUser] = useState('');
            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-900 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-[#86BC25] rounded-full flex items-center justify-center text-3xl font-bold mx-auto mb-4">D</div>
                            <h2 className="text-2xl font-bold text-gray-800">Smart-Alloc Portal</h2>
                            <p className="text-gray-500 text-sm">Enterprise Resource & Workflow System</p>
                        </div>
                        <select className="w-full p-4 border rounded-xl mb-4 bg-gray-50" onChange={(e) => setSelectedUser(e.target.value)}>
                            <option value="">Select Identity...</option>
                            <option value="admin">James Brown (Admin/Boss)</option>
                            {employees.map(e => <option key={e.id} value={e.id}>{e.name} (Employee)</option>)}
                        </select>
                        <button onClick={() => {
                            if(!selectedUser) return;
                            if(selectedUser === 'admin') onLogin({ name: 'James Brown', role: 'Admin' });
                            else onLogin({ ...employees.find(e => e.id == selectedUser), role: 'Employee' });
                        }} className="w-full py-3 bg-black text-white font-bold rounded-xl hover:bg-gray-800">Login</button>
                    </div>
                </div>
            );
        };

        const TaskManager = ({ tasks, setTasks, employees, currentUser, showToast }) => {
            const [proofInput, setProofInput] = useState('');
            const [submittingId, setSubmittingId] = useState(null);

            // Admin: Assign New Task
            const [newTask, setNewTask] = useState({ title: '', assignee: '', hours: 0, priority: 'Medium' });

            const handleAssign = (e) => {
                e.preventDefault();
                setTasks([...tasks, { id: Date.now(), ...newTask, status: 'Pending', proof: '', hours: parseInt(newTask.hours) }]);
                showToast('Task Assigned Successfully', 'success');
            };

            // Employee: Submit Proof
            const handleSubmitProof = (taskId) => {
                if (!proofInput.trim()) {
                    showToast('Proof link (URL) is required!', 'error');
                    return;
                }
                setTasks(tasks.map(t => t.id === taskId ? { ...t, status: 'Review Pending', proof: proofInput } : t));
                setSubmittingId(null);
                setProofInput('');
                showToast('Work Submitted for Manager Approval', 'success');
            };

            // Admin: Review Workflow
            const handleApproval = (taskId, isApproved) => {
                const newStatus = isApproved ? 'Completed' : 'In Progress';
                setTasks(tasks.map(t => t.id === taskId ? { ...t, status: newStatus } : t));
                showToast(isApproved ? 'Task Approved & Closed' : 'Task Rejected - Sent Back', isApproved ? 'success' : 'error');
            };

            // Filter Views
            const myTasks = currentUser.role === 'Admin' ? tasks : tasks.filter(t => t.assignee === currentUser.name);

            return (
                <div className="space-y-8 fade-in">
                    {/* Admin Assignment Panel */}
                    {currentUser.role === 'Admin' && (
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h3 className="font-bold text-lg mb-4">Assign Operational Task</h3>
                            <form onSubmit={handleAssign} className="grid grid-cols-1 md:grid-cols-5 gap-4">
                                <input placeholder="Task Title" className="md:col-span-2 p-3 border rounded-lg" value={newTask.title} onChange={e => setNewTask({...newTask, title: e.target.value})} required />
                                <select className="p-3 border rounded-lg" value={newTask.assignee} onChange={e => setNewTask({...newTask, assignee: e.target.value})} required>
                                    <option value="">Assignee</option>
                                    {employees.map(e => <option key={e.id} value={e.name}>{e.name}</option>)}
                                </select>
                                <input type="number" placeholder="Hours" className="p-3 border rounded-lg" value={newTask.hours} onChange={e => setNewTask({...newTask, hours: e.target.value})} required />
                                <button type="submit" className="bg-black text-white font-bold rounded-lg hover:bg-gray-800">Assign</button>
                            </form>
                        </div>
                    )}

                    {/* Task List */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                            <h3 className="font-bold text-lg">{currentUser.role === 'Admin' ? 'Workflow Overview' : 'My Assigned Deliverables'}</h3>
                            <span className="text-xs bg-gray-100 px-3 py-1 rounded-full text-gray-600">Real-time Sync Active</span>
                        </div>
                        <table className="w-full text-left text-sm">
                            <thead className="bg-gray-50 text-gray-500 uppercase font-bold text-xs">
                                <tr>
                                    <th className="p-4">Task</th>
                                    <th className="p-4">Status</th>
                                    <th className="p-4">Proof of Work</th>
                                    <th className="p-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {myTasks.map(task => (
                                    <tr key={task.id} className="hover:bg-gray-50">
                                        <td className="p-4">
                                            <div className="font-bold text-gray-800">{task.title}</div>
                                            <div className="text-xs text-gray-500">{task.assignee} â€¢ {task.hours} hrs</div>
                                        </td>
                                        <td className="p-4">
                                            <span className={`px-2 py-1 rounded text-xs font-bold 
                                                ${task.status === 'Completed' ? 'bg-green-100 text-green-700' : 
                                                task.status === 'Review Pending' ? 'bg-yellow-100 text-yellow-700' : 
                                                'bg-blue-50 text-blue-700'}`}>
                                                {task.status}
                                            </span>
                                        </td>
                                        <td className="p-4">
                                            {task.proof ? (
                                                <a href={`https://${task.proof}`} target="_blank" className="text-blue-600 hover:underline flex items-center gap-1">
                                                    <i className="fas fa-link"></i> View Evidence
                                                </a>
                                            ) : (
                                                <span className="text-gray-400 italic">No proof submitted</span>
                                            )}
                                        </td>
                                        <td className="p-4 text-right">
                                            {/* ADMIN ACTIONS */}
                                            {currentUser.role === 'Admin' && task.status === 'Review Pending' && (
                                                <div className="flex justify-end gap-2">
                                                    <button onClick={() => handleApproval(task.id, true)} className="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Approve</button>
                                                    <button onClick={() => handleApproval(task.id, false)} className="px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200">Reject</button>
                                                </div>
                                            )}
                                            
                                            {/* EMPLOYEE ACTIONS */}
                                            {currentUser.role === 'Employee' && task.status !== 'Completed' && task.status !== 'Review Pending' && (
                                                submittingId === task.id ? (
                                                    <div className="flex gap-2 items-center justify-end">
                                                        <input 
                                                            autoFocus
                                                            placeholder="Paste Link/ID..." 
                                                            className="border p-1 rounded w-32 text-xs"
                                                            value={proofInput}
                                                            onChange={e => setProofInput(e.target.value)}
                                                        />
                                                        <button onClick={() => handleSubmitProof(task.id)} className="text-green-600 text-lg"><i className="fas fa-check-circle"></i></button>
                                                        <button onClick={() => setSubmittingId(null)} className="text-red-400 text-lg"><i className="fas fa-times-circle"></i></button>
                                                    </div>
                                                ) : (
                                                    <div className="flex gap-2 justify-end">
                                                        {task.status === 'Pending' && (
                                                            <button onClick={() => setTasks(tasks.map(t => t.id === task.id ? {...t, status: 'In Progress'} : t))} className="text-blue-600 hover:underline">Start</button>
                                                        )}
                                                        {task.status === 'In Progress' && (
                                                            <button onClick={() => setSubmittingId(task.id)} className="bg-black text-white px-3 py-1 rounded text-xs hover:bg-gray-800">Submit Work</button>
                                                        )}
                                                    </div>
                                                )
                                            )}
                                            {task.status === 'Completed' && <span className="text-green-600 font-bold text-xs"><i className="fas fa-check"></i> Verified</span>}
                                            {currentUser.role === 'Employee' && task.status === 'Review Pending' && <span className="text-yellow-600 italic text-xs">Waiting Approval</span>}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [tasks, setTasks] = useState(initialTasks);
            const [toast, setToast] = useState(null);

            const showToast = (message, type) => setToast({ message, type });

            if (!currentUser) return <LoginScreen employees={initialEmployees} onLogin={setCurrentUser} />;

            return (
                <div className="min-h-screen flex flex-col md:flex-row">
                    {/* Sidebar */}
                    <div className="w-full md:w-64 bg-black text-white p-6 flex flex-col justify-between">
                        <div>
                            <div className="flex items-center gap-2 mb-8">
                                <div className="w-8 h-8 bg-[#86BC25] rounded-full flex items-center justify-center font-bold text-black">D</div>
                                <span className="font-bold text-lg">Smart-Alloc</span>
                            </div>
                            <div className="bg-gray-900 rounded-lg p-4 mb-4">
                                <div className="text-xs text-gray-400 uppercase font-bold mb-1">Logged In As</div>
                                <div className="font-bold">{currentUser.name}</div>
                                <div className="text-xs text-[#86BC25]">{currentUser.role}</div>
                            </div>
                        </div>
                        <button onClick={() => setCurrentUser(null)} className="text-gray-400 hover:text-white text-sm flex items-center gap-2">
                            <i className="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 p-8 overflow-y-auto">
                        <header className="flex justify-between items-center mb-8">
                            <h1 className="text-3xl font-bold text-gray-800">
                                {currentUser.role === 'Admin' ? 'Management Console' : 'Employee Workspace'}
                            </h1>
                            {currentUser.role === 'Employee' && (
                                <div className="bg-yellow-50 text-yellow-800 px-4 py-2 rounded-lg text-sm border border-yellow-200">
                                    <i className="fas fa-shield-alt mr-2"></i> Anti-Cheat Protocols Active
                                </div>
                            )}
                        </header>
                        
                        <TaskManager 
                            tasks={tasks} 
                            setTasks={setTasks} 
                            employees={initialEmployees} 
                            currentUser={currentUser}
                            showToast={showToast}
                        />
                    </main>
                    
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
