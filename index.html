<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Alloc | Resource Analytics</title>
    
    <!-- React & ReactDOM (Stable Versions) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Prop Types (Required dependency for some Recharts UMD builds) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- Recharts (Pinned to stable UMD version) -->
    <script src="https://unpkg.com/recharts@2.10.4/umd/Recharts.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .deloitte-green { color: #86BC25; }
        .deloitte-bg-green { background-color: #86BC25; }
        .deloitte-black { background-color: #000000; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Ensure globals are available
        const { useState, useEffect, useMemo } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } = window.Recharts;

        // --- Mock Data Generators ---
        const initialEmployees = [
            { id: 1, name: 'Amit Sharma', role: 'Senior Analyst', department: 'Consulting' },
            { id: 2, name: 'Priya Verma', role: 'Developer', department: 'Engineering' },
            { id: 3, name: 'Rohan Das', role: 'Data Scientist', department: 'Analytics' },
            { id: 4, name: 'Sneha Roy', role: 'UX Designer', department: 'Product' },
        ];

        const initialTasks = [
            { id: 101, title: 'Client Requirement Analysis', assignee: 'Amit Sharma', status: 'In Progress', hours: 12, deadline: '2026-02-10' },
            { id: 102, title: 'Database Migration', assignee: 'Priya Verma', status: 'Completed', hours: 8, deadline: '2026-01-20' },
            { id: 103, title: 'Q1 Financial Modeling', assignee: 'Amit Sharma', status: 'Pending', hours: 15, deadline: '2026-02-15' },
            { id: 104, title: 'API Integration', assignee: 'Priya Verma', status: 'In Progress', hours: 20, deadline: '2026-03-01' },
            { id: 105, title: 'Customer Churn Analysis', assignee: 'Rohan Das', status: 'In Progress', hours: 25, deadline: '2026-02-28' },
        ];

        // --- Components ---

        const Sidebar = ({ activeTab, setActiveTab }) => (
            <div className="w-64 bg-black text-white h-screen fixed left-0 top-0 flex flex-col shadow-lg z-10 hidden md:flex">
                <div className="p-6 border-b border-gray-800 flex items-center gap-3">
                    <div className="w-8 h-8 deloitte-bg-green rounded-full flex items-center justify-center font-bold text-black">D</div>
                    <span className="text-xl font-bold tracking-tight">Smart-Alloc</span>
                </div>
                <nav className="flex-1 p-4 space-y-2">
                    <button 
                        onClick={() => setActiveTab('dashboard')}
                        className={`w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition-colors ${activeTab === 'dashboard' ? 'deloitte-bg-green text-black font-bold' : 'hover:bg-gray-900 text-gray-300'}`}
                    >
                        <i className="fas fa-chart-pie"></i> Analytics Dashboard
                    </button>
                    <button 
                        onClick={() => setActiveTab('tasks')}
                        className={`w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition-colors ${activeTab === 'tasks' ? 'deloitte-bg-green text-black font-bold' : 'hover:bg-gray-900 text-gray-300'}`}
                    >
                        <i className="fas fa-tasks"></i> Task Management
                    </button>
                    <button 
                        onClick={() => setActiveTab('team')}
                        className={`w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition-colors ${activeTab === 'team' ? 'deloitte-bg-green text-black font-bold' : 'hover:bg-gray-900 text-gray-300'}`}
                    >
                        <i className="fas fa-users"></i> Team & Resources
                    </button>
                </nav>
                <div className="p-4 border-t border-gray-800 text-xs text-gray-500">
                    <div>User: James Brown</div>
                    <div>Role: Administrator</div>
                    <div className="mt-2 text-[10px] uppercase tracking-widest">Deloitte Format v2.0</div>
                </div>
            </div>
        );

        const StatCard = ({ title, value, icon, trend, trendUp }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div className="flex justify-between items-start">
                    <div>
                        <p className="text-gray-500 text-sm font-medium uppercase tracking-wider">{title}</p>
                        <h3 className="text-2xl font-bold text-gray-800 mt-1">{value}</h3>
                    </div>
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${trendUp ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}`}>
                        <i className={`fas ${icon}`}></i>
                    </div>
                </div>
                <div className="mt-4 flex items-center text-xs">
                    <span className={`${trendUp ? 'text-green-600' : 'text-gray-500'} font-semibold`}>
                        {trend}
                    </span>
                    <span className="text-gray-400 ml-1">vs last month</span>
                </div>
            </div>
        );

        const Dashboard = ({ tasks, employees }) => {
            // Analytics Logic
            const totalHours = tasks.reduce((sum, t) => sum + t.hours, 0);
            const activeTasks = tasks.filter(t => t.status === 'In Progress').length;
            const completedTasks = tasks.filter(t => t.status === 'Completed').length;
            
            // Data for Bar Chart (Workload per Employee)
            const workloadData = employees.map(emp => {
                const empTasks = tasks.filter(t => t.assignee === emp.name);
                const hours = empTasks.reduce((sum, t) => sum + t.hours, 0);
                return { name: emp.name.split(' ')[0], hours: hours };
            });

            // Data for Pie Chart (Task Status)
            const statusData = [
                { name: 'Completed', value: completedTasks },
                { name: 'In Progress', value: activeTasks },
                { name: 'Pending', value: tasks.filter(t => t.status === 'Pending').length }
            ];
            const COLORS = ['#86BC25', '#000000', '#9CA3AF'];

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <StatCard title="Total Projects" value={tasks.length} icon="fa-folder" trend="+12%" trendUp={true} />
                        <StatCard title="Active Tasks" value={activeTasks} icon="fa-clock" trend="+5%" trendUp={true} />
                        <StatCard title="Efficiency Rate" value="92%" icon="fa-chart-line" trend="+2.4%" trendUp={true} />
                        <StatCard title="Resource Util." value={`${employees.length} Active`} icon="fa-user-check" trend="Stable" trendUp={false} />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Resource Allocation Chart */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">Resource Workload (Hours)</h3>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={workloadData}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <XAxis dataKey="name" />
                                    <YAxis />
                                    <Tooltip cursor={{fill: '#f3f4f6'}} />
                                    <Bar dataKey="hours" fill="#000000" radius={[4, 4, 0, 0]} barSize={40} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Project Status Pie Chart */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">Project Status Distribution</h3>
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie
                                        data={statusData}
                                        cx="50%"
                                        cy="50%"
                                        innerRadius={60}
                                        outerRadius={80}
                                        paddingAngle={5}
                                        dataKey="value"
                                    >
                                        {statusData.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                        ))}
                                    </Pie>
                                    <Tooltip />
                                    <Legend />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>
            );
        };

        const TaskManager = ({ tasks, setTasks, employees }) => {
            const [newTask, setNewTask] = useState({ title: '', assignee: '', hours: 0, status: 'Pending', deadline: '' });

            const handleAddTask = (e) => {
                e.preventDefault();
                if (!newTask.title || !newTask.assignee) return;
                
                const task = {
                    id: Date.now(),
                    ...newTask,
                    hours: parseInt(newTask.hours)
                };
                setTasks([...tasks, task]);
                setNewTask({ title: '', assignee: '', hours: 0, status: 'Pending', deadline: '' });
            };

            const handleDelete = (id) => {
                setTasks(tasks.filter(t => t.id !== id));
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in">
                    {/* Add Task Form */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">Assign New Task</h3>
                        <form onSubmit={handleAddTask} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                                <input 
                                    type="text" 
                                    className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent outline-none"
                                    placeholder="e.g. Audit Report Q3"
                                    value={newTask.title}
                                    onChange={e => setNewTask({...newTask, title: e.target.value})}
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Assignee</label>
                                <select 
                                    className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent outline-none"
                                    value={newTask.assignee}
                                    onChange={e => setNewTask({...newTask, assignee: e.target.value})}
                                    required
                                >
                                    <option value="">Select Employee</option>
                                    {employees.map(emp => (
                                        <option key={emp.id} value={emp.name}>{emp.name}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Est. Hours</label>
                                    <input 
                                        type="number" 
                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent outline-none"
                                        value={newTask.hours}
                                        onChange={e => setNewTask({...newTask, hours: e.target.value})}
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                    <select 
                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent outline-none"
                                        value={newTask.status}
                                        onChange={e => setNewTask({...newTask, status: e.target.value})}
                                    >
                                        <option>Pending</option>
                                        <option>In Progress</option>
                                        <option>Completed</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" className="w-full deloitte-black text-white font-bold py-3 rounded-lg hover:opacity-90 transition-opacity">
                                <i className="fas fa-plus mr-2"></i> Allocate Resource
                            </button>
                        </form>
                    </div>

                    {/* Task List */}
                    <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">Active Engagements</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead>
                                    <tr className="text-sm text-gray-500 border-b border-gray-100">
                                        <th className="py-3 font-semibold">Task</th>
                                        <th className="py-3 font-semibold">Assigned To</th>
                                        <th className="py-3 font-semibold">Status</th>
                                        <th className="py-3 font-semibold">Workload</th>
                                        <th className="py-3 font-semibold text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {tasks.map(task => (
                                        <tr key={task.id} className="border-b border-gray-50 hover:bg-gray-50 transition-colors text-sm">
                                            <td className="py-3 font-medium text-gray-800">{task.title}</td>
                                            <td className="py-3 text-gray-600">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">
                                                        {task.assignee.charAt(0)}
                                                    </div>
                                                    {task.assignee}
                                                </div>
                                            </td>
                                            <td className="py-3">
                                                <span className={`px-2 py-1 rounded-full text-xs font-semibold
                                                    ${task.status === 'Completed' ? 'bg-green-100 text-green-700' : 
                                                      task.status === 'In Progress' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-600'}`}>
                                                    {task.status}
                                                </span>
                                            </td>
                                            <td className="py-3 text-gray-600">{task.hours} hrs</td>
                                            <td className="py-3 text-right">
                                                <button onClick={() => handleDelete(task.id)} className="text-red-400 hover:text-red-600">
                                                    <i className="fas fa-trash-alt"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                    {tasks.length === 0 && (
                                        <tr>
                                            <td colSpan="5" className="py-8 text-center text-gray-400">No active tasks found.</td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [tasks, setTasks] = useState(() => {
                const saved = localStorage.getItem('sa_tasks');
                return saved ? JSON.parse(saved) : initialTasks;
            });
            const [employees] = useState(initialEmployees);

            // Persist tasks to local storage
            useEffect(() => {
                localStorage.setItem('sa_tasks', JSON.stringify(tasks));
            }, [tasks]);

            return (
                <div className="flex min-h-screen">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />
                    
                    <main className="flex-1 md:ml-64 p-6 md:p-10 transition-all">
                        {/* Mobile Header */}
                        <div className="md:hidden flex items-center justify-between mb-6">
                            <h1 className="text-xl font-bold">Smart-Alloc</h1>
                            <div className="p-2 bg-gray-200 rounded text-gray-600">
                                <i className="fas fa-bars"></i>
                            </div>
                        </div>

                        {/* Top Bar */}
                        <div className="flex justify-between items-center mb-8">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-900">
                                    {activeTab === 'dashboard' ? 'Analytics Overview' : 
                                     activeTab === 'tasks' ? 'Task Management' : 'Team Overview'}
                                </h1>
                                <p className="text-gray-500 text-sm mt-1">Welcome back, James. Here's what's happening today.</p>
                            </div>
                            <div className="flex gap-4">
                                <button className="bg-white p-2 rounded-full shadow-sm text-gray-600 hover:text-black w-10 h-10 flex items-center justify-center relative">
                                    <i className="fas fa-bell"></i>
                                    <span className="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
                                </button>
                                <div className="hidden md:flex items-center gap-2 bg-white px-3 py-1 rounded-full shadow-sm border border-gray-100">
                                    <div className="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center text-white text-xs">JB</div>
                                    <span className="text-sm font-semibold text-gray-700">James Brown</span>
                                </div>
                            </div>
                        </div>

                        {/* Content Area */}
                        {activeTab === 'dashboard' && <Dashboard tasks={tasks} employees={employees} />}
                        {activeTab === 'tasks' && <TaskManager tasks={tasks} setTasks={setTasks} employees={employees} />}
                        {activeTab === 'team' && (
                            <div className="bg-white p-10 rounded-xl shadow-sm text-center">
                                <div className="text-6xl text-gray-200 mb-4"><i className="fas fa-user-lock"></i></div>
                                <h3 className="text-xl font-bold text-gray-800">Admin Access Required</h3>
                                <p className="text-gray-500 mt-2">Team management is restricted to HR Administrators in this demo.</p>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>